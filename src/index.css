@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@600;700;800&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

/* ---------- Paleta global (lava/ember) ---------- */
:root{
  --lava-bg: #1C1C1C;
  --lava-a: #F86F27; /* brillo */
  --lava-b: #B93A19; /* rojo tostado */
  --lava-c: #BC602D; /* naranja medio */
  --lava-d: #4E231C; /* sombra cálida */
}

/* ===== Base mínima ===== */
@layer base {
  * { @apply border-transparent; }

  body {
    @apply text-slate-900 font-sans antialiased;
    background: var(--lava-bg);
  }
}

/* Fondo global con blobs suaves (debajo de todo) */
html, body { background: var(--lava-bg) !important; }
body::before{
  content:"";
  position: fixed;
  inset: 0;
  z-index: -1;          /* detrás de todo */
  pointer-events: none;
  background:
    radial-gradient(72% 60% at 95% 0%,
      color-mix(in oklab, var(--lava-a) 70%, transparent) 0%,
      color-mix(in oklab, var(--lava-c) 45%, transparent) 35%,
      color-mix(in oklab, var(--lava-d) 25%, transparent) 63%,
      transparent 100%
    ),
    radial-gradient(50% 40% at 20% 60%,
      color-mix(in oklab, var(--lava-b) 40%, transparent) 0%,
      transparent 70%
    ),
    radial-gradient(65% 55% at 50% 110%,
      color-mix(in oklab, var(--lava-c) 25%, transparent) 0%,
      transparent 80%
    ),
    linear-gradient(var(--lava-bg), var(--lava-bg));
  filter: saturate(1.05) contrast(1.02);
}

/* Si tu sidebar tiene color sólido, hazla transparente
   (añade la clase .app-sidebar a tu sidebar) */
.app-sidebar{ background: transparent !important; }

/* ===== Header centrado ===== */
.header-top { @apply fixed left-1/2 -translate-x-1/2 top-3 z-30 text-center; }
.header-top h2 { @apply text-slate-600 text-sm font-semibold; }
.header-top p  { @apply text-slate-400 text-[11px] mt-0.5; }

/* Apaga cualquier fade blanco global heredado */
.top-fade{ display:none !important; }

/* ===== Burbujas ===== */
.bubble {
  position: relative;
  box-shadow:
    0 10px 24px -12px rgba(2, 6, 23, 0.18),
    0 4px 10px -6px rgba(2, 6, 23, 0.10);
  backdrop-filter: saturate(1.05);
}
.bubble-ai { background: #ECECF3; color:#0f172a; border-radius: 1rem; }
.bubble-user { background: #ffffff; color:#0f172a; border-radius: 1rem; border:1px solid #e5e7eb; }

/* Anim de entrada */
.msg-in { animation: msg-in .34s cubic-bezier(.22,.61,.36,1); }
@keyframes msg-in {
  0% { opacity:0; transform: translateY(6px) scale(.98); filter: blur(1px); }
  100%{ opacity:1; transform:none; filter: blur(0); }
}
/* Sheen suave */
.bubble .bubble-sheen {
  content:"";
  position:absolute; inset:0; pointer-events:none;
  background: linear-gradient(120deg, rgba(255,255,255,0) 30%, rgba(255,255,255,0.45) 50%, rgba(255,255,255,0) 70%);
  transform: translateX(-120%);
  animation: sheen 1.1s ease-out 120ms forwards;
  opacity:.6; mix-blend-mode: screen;
}
@keyframes sheen { to { transform: translateX(120%); opacity:0; } }

/* ===== Input flotante ===== */
.chat-input-wrap{ @apply fixed bottom-4 left-1/2 -translate-x-1/2 z-30 w-full max-w-4xl px-4; }
.chat-input{
  @apply w-full bg-white/95 backdrop-blur border border-slate-200 rounded-[28px] sm:rounded-[32px] shadow-md px-3 py-2;
}
.chat-input textarea{ @apply text-slate-900 placeholder:text-slate-400 leading-[1.4]; }
.icon-ghost { @apply text-slate-400; }

/* Aviso centrado bajo el input */
.input-disclaimer{ @apply mt-2 text-center text-[11px] text-slate-500 select-none; }

/* Accesibilidad */
@media (prefers-reduced-motion: reduce){
  .msg-in { animation:none!important; }
}

/* ===== Bienvenida estilo poster (fuente nueva, BLANCO) ===== */
.welcome-poster{
  font-family: 'Outfit', ui-sans-serif, system-ui, -apple-system, 'Segoe UI',
               Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
  font-weight: 800;
  font-size: clamp(34px, 6.2vw, 72px);
  letter-spacing: -0.02em;
  line-height: .95;
  white-space: pre-line;

  color: #fff !important;
  text-shadow:
    0 1px 0 rgba(255,255,255,.04),
    0 14px 34px rgba(0,0,0,.55);
}

/* ===== Avatar IA — esfera multicolor ===== */
.avatar-sphere{
  width: 2rem; height: 2rem; position: relative;
  border-radius: 9999px; overflow: hidden;
  clip-path: circle(calc(50% - 0.6px) at 50% 50%);
  background: transparent; transform: translateZ(0);
  backface-visibility: hidden; z-index: 3;
  box-shadow: 0 3px 10px rgba(94,46,244,.18), inset 0 0 2px rgba(255,255,255,.5);
}
.avatar-sphere .avatar-core,
.avatar-sphere .avatar-core::before,
.avatar-sphere .avatar-core::after{
  content:""; position:absolute; width: 260%; height: 260%;
  left: -80%; top: -80%; border-radius: 50%; pointer-events:none;
  filter: blur(14px) saturate(1.55) contrast(1.12) brightness(1.05);
  will-change: transform; animation-timing-function: ease-in-out;
  animation-iteration-count: infinite; opacity: .95;
}
.avatar-sphere .avatar-core{
  background:
    radial-gradient(closest-side at 48% 46%, #B55FDE, transparent 62%),
    radial-gradient(closest-side at 30% 72%, #5E2EF4, transparent 65%),
    radial-gradient(closest-side at 74% 32%, #EA6987, transparent 62%),
    radial-gradient(closest-side at 66% 78%, #85B4E2, transparent 70%);
  animation: mix-pan-core 8.2s infinite;
}
.avatar-sphere .avatar-core::before{
  background:
    radial-gradient(closest-side at 36% 42%, #F6AEBC, transparent 60%),
    radial-gradient(closest-side at 58% 30%, #D967C9, transparent 60%);
  animation: mix-pan-a 9.8s infinite;
}
.avatar-sphere .avatar-core::after{
  background:
    radial-gradient(closest-side at 56% 66%, #729EDD, transparent 60%),
    radial-gradient(closest-side at 42% 60%, #E0B89F, transparent 60%);
  animation: mix-pan-b 11.2s infinite;
}
.avatar-sphere::after{
  content:""; position:absolute; inset:0; border-radius:inherit; pointer-events:none;
  background:
    radial-gradient(140% 120% at 28% 20%, rgba(255,255,255,.35), rgba(255,255,255,0) 55%),
    radial-gradient(120% 120% at 75% 85%, rgba(0,0,0,.10), rgba(0,0,0,0) 60%);
  box-shadow: inset 0 0 8px rgba(0,0,0,.06);
}
@keyframes mix-pan-core{
  0%   { transform: translate(-12%, -8%)  scale(1.03) }
  28%  { transform: translate(  8%, -5%)  scale(1.00) }
  55%  { transform: translate( 12%, 11%)  scale(1.05) }
  82%  { transform: translate( -9%, 13%)  scale(1.02) }
  100% { transform: translate(-12%, -8%)  scale(1.03) }
}
@keyframes mix-pan-a{
  0%   { transform: translate(14%, -14%) scale(1.02) }
  33%  { transform: translate(-9%,   9%) scale(1.06) }
  66%  { transform: translate(12%,   3%) scale(1.01) }
  100% { transform: translate(14%, -14%) scale(1.02) }
}
@keyframes mix-pan-b{
  0%   { transform: translate(-8%, 16%) scale(1.03) }
  33%  { transform: translate(10%, -10%) scale(1.07) }
  66%  { transform: translate(-14%, 6%) scale(1.02) }
  100% { transform: translate(-8%, 16%) scale(1.03) }
}

/* ===== Botón ENVIAR — esfera animada ===== */
.send-sphere{
  position: absolute; inset: 0; border-radius: 9999px; overflow: hidden;
  isolation: isolate; contain: paint; background: transparent;
  box-shadow: inset 0 0 2px rgba(255,255,255,.35), 0 2px 8px rgba(17,24,39,.10);
}
.send-sphere .send-core{
  position: absolute; width: 220%; height: 220%; left: -60%; top:-60%;
  border-radius: 50%;
  background:
    radial-gradient(closest-side at 35% 35%, #F0CDEE, transparent 62%),
    radial-gradient(closest-side at 72% 36%, #EA94AF, transparent 62%),
    radial-gradient(closest-side at 64% 76%, #FBAE56, transparent 63%),
    radial-gradient(closest-side at 28% 72%, #9441B3, transparent 60%),
    radial-gradient(closest-side at 54% 58%, #6D204E, transparent 60%),
    radial-gradient(closest-side at 68% 60%, #F9B995, transparent 60%),
    radial-gradient(closest-side at 42% 62%, #E6522A, transparent 60%),
    radial-gradient(closest-side at 58% 40%, #F5E1C6, transparent 60%);
  filter: blur(12px) saturate(1.45) contrast(1.04) brightness(1.04);
  will-change: transform; animation: send-mix 7.6s ease-in-out infinite alternate;
  transform: translateZ(0);
}
.send-sphere::after{
  content:""; position:absolute; inset:0; border-radius:inherit; pointer-events:none;
  background:
    radial-gradient(120% 110% at 28% 20%, rgba(255,255,255,.45), rgba(255,255,255,0) 58%),
    radial-gradient(110% 110% at 78% 82%, rgba(0,0,0,.10), rgba(0,0,0,0) 60%);
}
@keyframes send-mix{
  0%   { transform: translate(-10%, -8%) scale(1.03); }
  50%  { transform: translate( 12%,  10%) scale(1.05); }
  100% { transform: translate(-14%,   6%) scale(1.02); }
}

/* ===== Override: Burbujas pill ===== */
.bubble{ border-radius: 9999px !important; padding: 14px 18px; }
.bubble-ai{
  background:#ffffff !important; color:#0f172a !important;
  border:1px solid #e5e7eb !important; border-radius:9999px !important; z-index:1;
  box-shadow: 0 10px 28px rgba(15,23,42,.08), 0 4px 10px rgba(15,23,42,.06);
}
.bubble-ai::before{ content:none !important; display:none !important; }
.bubble-user{
  background:#111827 !important; color:#ffffff !important; border:0 !important; border-radius:9999px !important;
  box-shadow: 0 12px 30px rgba(15,23,42,.20), 0 4px 12px rgba(15,23,42,.10);
}
.bubble-user::before{ content:none !important; }
.bubble-user .bubble-sheen{ display:none; }
.bubble-ai   .bubble-sheen{ display:block; }
.msg-in .bubble{ margin-bottom: 10px; }

/* ===== Responsivo ===== */
@media (max-width: 640px){
  body{ padding-bottom: calc(96px + env(safe-area-inset-bottom)); }
  .msg-in .bubble{
    max-width: 88% !important; min-width: 60% !important; padding: 12px 16px; margin-bottom: 12px;
  }
  .avatar-sphere{ width: 1.6rem; height: 1.6rem; margin-left: 2px; }
  .msg-in .bubble .text-sm{ line-height: 1.35; }
  .msg-in > .flex.flex-col > .mt-1{ margin-top: 2px !important; }
  .bubble-ai{ box-shadow: 0 10px 20px rgba(15,23,42,.06), 0 2px 8px rgba(15,23,42,.05); }
  .bubble-user{ box-shadow: 0 10px 24px rgba(15,23,42,.18), 0 3px 10px rgba(15,23,42,.10); }
}
.msg-in:last-child{ scroll-margin-bottom: 110px; }

@media (max-width: 640px){
  body{ padding-bottom: calc(112px + env(safe-area-inset-bottom)); }
  .msg-in .bubble{
    max-width: 92% !important; min-width: 66% !important; padding: 12px 16px; margin-bottom: 12px;
  }
  .avatar-sphere{ width: 1.7rem; height: 1.7rem; margin-left: 2px; }
}
.msg-in:last-child{ scroll-margin-bottom: 140px; }

@media (max-width: 640px){
  .msg-in .bubble{
    display: inline-flex !important;
    width: -webkit-fit-content !important;
    width: -moz-fit-content !important;
    width: fit-content !important;
    min-width: 0 !important;
    max-width: calc(100vw - 120px) !important;
    white-space: pre-wrap; word-break: break-word;
  }
  .msg-in.justify-start .bubble{ margin-right: auto; }
  .msg-in.justify-end   .bubble{ margin-left:  auto; }
}

/* ===== Reply chip & preview ===== */
.reply-chip{
  font-size: 11px; line-height: 1; padding: 6px 10px; border-radius: 9999px;
  color: #475569; background: rgba(255,255,255,.85);
  border: 1px solid rgba(15,23,42,.08);
  box-shadow: 0 4px 10px rgba(15,23,42,.06);
  -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px);
  transition: transform .15s ease, background-color .15s ease, box-shadow .15s ease;
}
.reply-chip:hover{ background:#f8fafc; transform: translateY(-1px); }
.reply-chip:active{ transform: translateY(0); }

.reply-preview{
  position: relative; padding: 8px 34px 8px 12px; border-radius: 12px;
  border: 1px solid rgba(15,23,42,.06);
  background: linear-gradient(to right, rgba(244,240,255,.7), rgba(255,255,255,.7));
  -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px);
  box-shadow: 0 10px 24px -12px rgba(2,6,23,.12);
}
.reply-preview::before{
  content:""; position:absolute; left:0; top:0; bottom:0; width:3px; border-radius:12px 0 0 12px;
  background-image: linear-gradient(180deg,#E0B89F,#B55FDE,#EA6987,#85B4E2); opacity:.85;
}
.reply-preview .rp-title{ font-size:11px; font-weight:600; color:#64748b; margin-bottom:2px; }
.reply-preview .rp-text{ font-size:12px; color:#475569; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; }
.reply-preview .rp-close{
  position:absolute; right:6px; top:6px; width:22px; height:22px; border-radius:9999px;
  display:grid; place-items:center; color:#64748b; background:rgba(255,255,255,.65);
  border:1px solid rgba(15,23,42,.06);
}
.reply-preview .rp-close:hover{ background:#ffffff; }

@media (max-width: 640px){
  .reply-chip{ font-size: 10px; padding: 6px 9px; }
  .reply-preview{ padding: 8px 32px 8px 10px; }
}

/* Variante alterna */
.reply-chip{
  display:inline-flex; align-items:center; gap:6px;
  font-size:11px; line-height:1; color:#64748b;
  padding:6px 10px; border-radius:9999px;
  background:#fff; border:1px solid #e5e7eb;
  box-shadow:0 2px 6px rgba(2,6,23,.06);
  transition:all .15s ease;
}
.reply-chip:hover{ color:#0f172a; border-color:#cbd5e1; box-shadow:0 4px 10px rgba(2,6,23,.08); }

.reply-preview{
  display:flex; align-items:flex-start; gap:10px;
  background:rgba(255,255,255,.95);
  -webkit-backdrop-filter:blur(8px); backdrop-filter:blur(8px);
  border:1px solid rgba(15,23,42,.08);
  border-radius:14px; padding:8px 12px;
  box-shadow:0 8px 20px -10px rgba(2,6,23,.15);
}
.reply-preview__label{ font-size:11px; color:#94a3b8; margin-top:2px; white-space:nowrap; }
.reply-preview__text{
  font-size:12px; color:#475569; display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:2;
  overflow:hidden; text-overflow:ellipsis;
}
.reply-preview__close{
  margin-left:auto; flex:none; display:inline-flex; align-items:center; justify-content:center;
  width:22px; height:22px; border-radius:9999px; color:#64748b; background:#f8fafc; border:1px solid #e2e8f0;
}
.reply-preview__close:hover{ background:#f1f5f9; color:#0f172a; }

/* ========== Kill-switch overlay antiguo ========== */
.thinking-overlay { display:none !important; }

/* ===== Header “Pensando…” con luces ===== */
.header-status-wrap{ display:inline-block; position:relative; }
.header-status-swap{ position: relative; display: inline-block; height: 1.1rem; min-width: 200px; }
.header-title{
  position: absolute; inset: 0; display: inline-block; text-align: center;
  font-weight: 600; font-size: 0.9rem; color: #475569;
  opacity: 0; transform: translateY(6px) scale(.98);
  transition: opacity .26s ease, transform .26s ease, filter .26s ease;
  filter: blur(0); will-change: opacity, transform, filter;
}
.header-title.is-active{ opacity: 1; transform: none; }
.header-title.thinking{
  color: transparent;
  background: linear-gradient(90deg, #B55FDE, #5E2EF4, #EA6987, #F6AEBC, #85B4E2, #E0B89F, #B55FDE);
  background-size: 220% 100%;
  -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
  animation: header-text-pan 5.8s ease-in-out infinite alternate;
}
.header-title.thinking::after{
  content: attr(data-text); position: absolute; inset: 0;
  -webkit-text-fill-color: transparent; color: transparent;
  background: linear-gradient(90deg, #B55FDE, #5E2EF4, #EA6987, #F6AEBC, #85B4E2, #E0B89F, #B55FDE);
  background-size: 220% 100%; -webkit-background-clip: text; background-clip: text;
  filter: blur(10px) saturate(1.35) brightness(1.06); transform: scale(1.06);
  opacity: .70; pointer-events: none; animation: header-text-pan 5.8s ease-in-out infinite alternate;
  transition: opacity .3s ease;
}
.header-title.thinking:not(.is-active)::after{ opacity: 0; }
@keyframes header-text-pan{ 0%{background-position:0% 50%} 100%{background-position:100% 50%} }
@media (max-width: 640px){
  .header-status-swap{ height: 1.2rem; min-width: 180px; }
  .header-title{ font-size: .95rem; }
  .header-title.thinking::after{ filter: blur(9px) saturate(1.25) brightness(1.05); }
}

/* ===== Barrido diagonal (cuando empieza la conversación) ===== */
.sweep-enter{ position: fixed; inset: 0; z-index: 40; pointer-events: none; overflow: hidden; }
.sweep-band{
  position: absolute; left: -15%; width: 130%; height: 38%; top: 100%;
  background: linear-gradient(100deg, #5F4E94, #E5D37F, #DF946C, #00000A, #C2736E, #D8CCE0, #5F4E94);
  background-size: 200% 200%; filter: blur(26px) saturate(1.15) contrast(1.02);
  opacity: 0.95; transform: translateY(20%) rotate(-2deg);
  animation: sweep-band-move 950ms cubic-bezier(.22,.61,.36,1) forwards, sweep-band-shift 6s ease-in-out infinite alternate;
}
.sweep-band--trail{ opacity: .55; filter: blur(36px) saturate(1.1); animation-delay: 60ms, 0s; }
@keyframes sweep-band-move{ 0%{ transform: translateY(20%) rotate(-2deg); } 100%{ transform: translateY(-140%) rotate(1deg); opacity:0; } }
@keyframes sweep-band-shift{ from {background-position:0% 50%} to {background-position:100% 50%} }

/* ===== Destello sobre el input durante el viaje ===== */
.input-sweep-sheen{
  position:absolute; inset:-2px; border-radius: 9999px; pointer-events:none;
  background: linear-gradient(120deg, rgba(255,255,255,0) 30%, rgba(255,255,255,.65) 48%, rgba(255,255,255,0) 70%);
  transform: translateX(-120%); animation: input-sheen 820ms ease-out forwards;
  mix-blend-mode: screen; opacity:.65; filter: blur(1px);
}
@keyframes input-sheen { to { transform: translateX(120%); opacity:0; } }

/* ===== Bloque SÓLIDO bajo el input (sin degradados) ===== */
/* Igual ancho que el input (max-w-4xl + px-4) */
.mask-wrap{
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  width:100%;
  max-width:56rem;   /* = max-w-4xl */
  padding:0 1rem;    /* = px-4 del input */
}
/* Color sólido del fondo del chat */
.chat-mask{
  width:100%;
  background: var(--lava-bg) !important; /* #1C1C1C */
  box-shadow:none;
  pointer-events:none;
  border-radius:0;
}
/* Apaga cualquier fade antiguo del input */
.chat-plate{ display:none !important; }
.chat-fade-up, .chat-fade-down{ display:none !important; }

/* Wrap de fades por si acaso */
.chat-fades-wrap{ pointer-events:none; }
.chat-fades-wrap .chat-plate,
.chat-fades-wrap .chat-fade-up,
.chat-fades-wrap .chat-fade-down { left:0; right:0; }