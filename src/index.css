@tailwind base;
@tailwind components;
@tailwind utilities;

/* ===== Base m√≠nima sobre blanco ===== */
@layer base {
  * { @apply border-transparent; }

  body {
    @apply bg-white text-slate-900 font-sans antialiased;
    background:#fff;
  }
}

/* ===== Header centrado (texto simple) ===== */
.header-top {
  @apply fixed left-1/2 -translate-x-1/2 top-3 z-30 text-center;
}
.header-top h2 {
  @apply text-slate-600 text-sm font-semibold;
}
.header-top p {
  @apply text-slate-400 text-[11px] mt-0.5;
}

/* ===== Fade superior ===== */
.top-fade {
  position: fixed;
  top: 48px;
  left: 0; right: 0;
  height: 90px;
  pointer-events: none;
  background: linear-gradient(to bottom, rgba(255,255,255,1), rgba(255,255,255,0));
  z-index: 5;
}

/* ===== Burbujas ===== */
.bubble {
  position: relative;
  box-shadow:
    0 10px 24px -12px rgba(2, 6, 23, 0.18),
    0 4px 10px -6px rgba(2, 6, 23, 0.10);
  backdrop-filter: saturate(1.05);
}
.bubble-ai { background: #ECECF3; color:#0f172a; border-radius: 1rem; }
.bubble-user { background: #ffffff; color:#0f172a; border-radius: 1rem; border:1px solid #e5e7eb; }

/* Anim de entrada */
.msg-in { animation: msg-in .34s cubic-bezier(.22,.61,.36,1); }
@keyframes msg-in {
  0% { opacity:0; transform: translateY(6px) scale(.98); filter: blur(1px); }
  100%{ opacity:1; transform:none; filter: blur(0); }
}
/* Sheen suave */
.bubble .bubble-sheen {
  content:"";
  position:absolute; inset:0; pointer-events:none;
  background: linear-gradient(120deg, rgba(255,255,255,0) 30%, rgba(255,255,255,0.45) 50%, rgba(255,255,255,0) 70%);
  transform: translateX(-120%);
  animation: sheen 1.1s ease-out 120ms forwards;
  opacity:.6; mix-blend-mode: screen;
}
@keyframes sheen { to { transform: translateX(120%); opacity:0; } }

/* ===== Input flotante ===== */
.chat-input-wrap{
  @apply fixed bottom-4 left-1/2 -translate-x-1/2 z-30 w-full max-w-4xl px-4;
}
.chat-input{
  /* antes: rounded-2xl */
  @apply w-full bg-white/95 backdrop-blur border border-slate-200 rounded-[28px] sm:rounded-[32px] shadow-md px-3 py-2;
}
.chat-input textarea{
  @apply text-slate-900 placeholder:text-slate-400 leading-[1.4];
}
.icon-ghost { @apply text-slate-400; }

/* Aviso centrado bajo el input */
.input-disclaimer{
  @apply mt-2 text-center text-[11px] text-slate-500 select-none;
}

/* Accesibilidad (limpia referencias al cuadro de pensamiento) */
@media (prefers-reduced-motion: reduce){
  .msg-in { animation:none!important; }
}

/* ====== Bienvenida estilo poster ====== */
.welcome-poster{
  background-image: linear-gradient(
    95deg,
    #E0B89F 0%,
    #B55FDE 10%,
    #C48099 18%,
    #D967C9 28%,
    #E986BC 36%,
    #9751E7 45%,
    #EA6987 55%,
    #F6AEBC 64%,
    #85B4E2 74%,
    #5E2EF4 83%,
    #729EDD 92%,
    #D9679A 100%
  );
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;

  display: inline-block;
  font-weight: 800;
  letter-spacing: -0.02em;
  line-height: .92;
  white-space: pre-line;
  background-size: 180% 180%;
  animation: poster-pan 10s ease-in-out infinite alternate;

  text-shadow:
    0 0 1px rgba(255,255,255,.35),
    0 10px 30px rgba(94,46,244,.16);
  filter:
    drop-shadow(0 8px 22px rgba(233,134,188,.18))
    drop-shadow(0 3px 8px rgba(0,0,0,.04));
}
.welcome-poster{ font-size: clamp(42px, 8vw, 96px); }
@keyframes poster-pan{
  0%   { background-position: 0% 50%; }
  100% { background-position: 100% 50%; }
}

/* ===== Avatar IA ‚Äî esfera multicolor sin blend (anti-borde) ===== */
.avatar-sphere{
  width: 2rem; /* 32px */
  height: 2rem;
  position: relative;
  border-radius: 9999px;
  overflow: hidden;
  clip-path: circle(calc(50% - 0.6px) at 50% 50%);
  background: transparent;
  transform: translateZ(0);
  backface-visibility: hidden;
  z-index: 3; /* sobre la burbuja para que parezca ‚Äúmorderla‚Äù */
  box-shadow:
    0 3px 10px rgba(94,46,244,.18),
    inset 0 0 2px rgba(255,255,255,.5);
}

/* Capas internas‚Ä¶ */
.avatar-sphere .avatar-core,
.avatar-sphere .avatar-core::before,
.avatar-sphere .avatar-core::after{
  content:"";
  position:absolute;
  width: 260%;
  height: 260%;
  left: -80%;
  top:  -80%;
  border-radius: 50%;
  pointer-events:none;
  filter: blur(14px) saturate(1.55) contrast(1.12) brightness(1.05);
  will-change: transform;
  animation-timing-function: ease-in-out;
  animation-iteration-count: infinite;
  opacity: .95;
}
.avatar-sphere .avatar-core{
  background:
    radial-gradient(closest-side at 48% 46%, #B55FDE, transparent 62%),
    radial-gradient(closest-side at 30% 72%, #5E2EF4, transparent 65%),
    radial-gradient(closest-side at 74% 32%, #EA6987, transparent 62%),
    radial-gradient(closest-side at 66% 78%, #85B4E2, transparent 70%);
  animation: mix-pan-core 8.2s infinite;
}
.avatar-sphere .avatar-core::before{
  background:
    radial-gradient(closest-side at 36% 42%, #F6AEBC, transparent 60%),
    radial-gradient(closest-side at 58% 30%, #D967C9, transparent 60%);
  animation: mix-pan-a 9.8s infinite;
}
.avatar-sphere .avatar-core::after{
  background:
    radial-gradient(closest-side at 56% 66%, #729EDD, transparent 60%),
    radial-gradient(closest-side at 42% 60%, #E0B89F, transparent 60%);
  animation: mix-pan-b 11.2s infinite;
}
.avatar-sphere::after{
  content:"";
  position:absolute; inset:0; border-radius:inherit; pointer-events:none;
  background:
    radial-gradient(140% 120% at 28% 20%, rgba(255,255,255,.35), rgba(255,255,255,0) 55%),
    radial-gradient(120% 120% at 75% 85%, rgba(0,0,0,.10), rgba(0,0,0,0) 60%);
  box-shadow: inset 0 0 8px rgba(0,0,0,.06);
}

/* Movimiento tipo ‚Äúmezcla de fluidos‚Äù (sin rotaci√≥n circular) */
@keyframes mix-pan-core{
  0%   { transform: translate(-12%, -8%)  scale(1.03) }
  28%  { transform: translate(  8%, -5%)  scale(1.00) }
  55%  { transform: translate( 12%, 11%)  scale(1.05) }
  82%  { transform: translate( -9%, 13%)  scale(1.02) }
  100% { transform: translate(-12%, -8%)  scale(1.03) }
}
@keyframes mix-pan-a{
  0%   { transform: translate(14%, -14%) scale(1.02) }
  33%  { transform: translate(-9%,   9%) scale(1.06) }
  66%  { transform: translate(12%,   3%) scale(1.01) }
  100% { transform: translate(14%, -14%) scale(1.02) }
}
@keyframes mix-pan-b{
  0%   { transform: translate(-8%, 16%) scale(1.03) }
  33%  { transform: translate(10%, -10%) scale(1.07) }
  66%  { transform: translate(-14%, 6%) scale(1.02) }
  100% { transform: translate(-8%, 16%) scale(1.03) }
}

/* ===== Bot√≥n ENVIAR ‚Äî esfera animada, CLIPPEADA dentro del bot√≥n ===== */
.send-sphere{
  position: absolute;
  inset: 0;
  border-radius: 9999px;
  overflow: hidden;
  isolation: isolate;
  contain: paint;
  background: transparent;
  box-shadow:
    inset 0 0 2px rgba(255,255,255,.35),
    0 2px 8px rgba(17,24,39,.10);
}
.send-sphere .send-core{
  position: absolute;
  width: 220%;
  height: 220%;
  left: -60%;
  top:  -60%;
  border-radius: 50%;
  background:
    radial-gradient(closest-side at 35% 35%, #F0CDEE, transparent 62%),
    radial-gradient(closest-side at 72% 36%, #EA94AF, transparent 62%),
    radial-gradient(closest-side at 64% 76%, #FBAE56, transparent 63%),
    radial-gradient(closest-side at 28% 72%, #9441B3, transparent 60%),
    radial-gradient(closest-side at 54% 58%, #6D204E, transparent 60%),
    radial-gradient(closest-side at 68% 60%, #F9B995, transparent 60%),
    radial-gradient(closest-side at 42% 62%, #E6522A, transparent 60%),
    radial-gradient(closest-side at 58% 40%, #F5E1C6, transparent 60%);
  filter: blur(12px) saturate(1.45) contrast(1.04) brightness(1.04);
  will-change: transform;
  animation: send-mix 7.6s ease-in-out infinite alternate;
  transform: translateZ(0);
}
.send-sphere::after{
  content:"";
  position:absolute; inset:0; border-radius:inherit; pointer-events:none;
  background:
    radial-gradient(120% 110% at 28% 20%, rgba(255,255,255,.45), rgba(255,255,255,0) 58%),
    radial-gradient(110% 110% at 78% 82%, rgba(0,0,0,.10), rgba(0,0,0,0) 60%);
}
@keyframes send-mix{
  0%   { transform: translate(-10%, -8%) scale(1.03); }
  50%  { transform: translate( 12%,  10%) scale(1.05); }
  100% { transform: translate(-14%,   6%) scale(1.02); }
}

/* ===== Override: Burbujas estilo "pill" con notch desactivado ===== */
.bubble{
  border-radius: 9999px !important;        /* pastilla total */
  padding: 14px 18px;                      /* un poco m√°s c√≥moda */
}

/* IA: pill clara (sin notch visible) */
.bubble-ai{
  background:#ffffff !important;
  color:#0f172a !important;
  border:1px solid #e5e7eb !important;
  border-radius:9999px !important;
  z-index:1;
  box-shadow:
    0 10px 28px rgba(15,23,42,.08),
    0 4px 10px rgba(15,23,42,.06);
}
/* üî¥ notch eliminado para evitar ‚Äúsegunda esfera‚Äù */
.bubble-ai::before{
  content:none !important;
  display:none !important;
}

/* Usuario: pill oscura sin notch */
.bubble-user{
  background:#111827 !important;
  color:#ffffff !important;
  border:0 !important;
  border-radius:9999px !important;
  box-shadow:
    0 12px 30px rgba(15,23,42,.20),
    0 4px 12px rgba(15,23,42,.10);
}
.bubble-user::before{ content:none !important; }

/* El brillo "sheen" s√≥lo en la burbuja clara */
.bubble-user .bubble-sheen{ display:none; }
.bubble-ai   .bubble-sheen{ display:block; }

/* Respiro para el timestamp */
.msg-in .bubble{ margin-bottom: 10px; }

/* ====== Mobile fix pack (<= 640px) ====== */
@media (max-width: 640px){

  /* 1) M√°s espacio abajo para que el input fijo no tape los mensajes */
  body{
    padding-bottom: calc(96px + env(safe-area-inset-bottom));
  }

  /* 2) Las burbujas usan m√°s ancho pero con m√≠nimo c√≥modo (evita ‚Äúpill‚Äù ultra-estirada) */
  .msg-in .bubble{
    max-width: 88% !important;
    min-width: 60% !important;
    padding: 12px 16px;
    margin-bottom: 12px;
  }

  /* 3) (notch de IA desactivado, este bloque ya no aplica) */
  .bubble-ai::before{
    content:none !important;
  }

  /* 4) Avatar-esfera un poco m√°s compacta */
  .avatar-sphere{
    width: 1.6rem;
    height: 1.6rem;
    margin-left: 2px;
  }

  /* 5) Texto y timestamp algo m√°s contenidos */
  .msg-in .bubble .text-sm{ line-height: 1.35; }
  .msg-in > .flex.flex-col > .mt-1{ margin-top: 2px !important; }

  /* 6) Sombras m√°s suaves en m√≥vil */
  .bubble-ai{
    box-shadow:
      0 10px 20px rgba(15,23,42,.06),
      0 2px 8px rgba(15,23,42,.05);
  }
  .bubble-user{
    box-shadow:
      0 10px 24px rgba(15,23,42,.18),
      0 3px 10px rgba(15,23,42,.10);
  }
}

/* Opcional, ayuda cuando saltas al √∫ltimo mensaje: deja margen de scroll
   suficiente para que no quede oculto tras el input fijo. */
.msg-in:last-child{ scroll-margin-bottom: 110px; }

/* ====== Mobile fit pack (<=640px) ‚Äî SOLO ajustes responsivos ====== */
@media (max-width: 640px){
  /* M√°s respiro lateral y abajo para que el input fijo no tape los mensajes */
  body{
    padding-bottom: calc(112px + env(safe-area-inset-bottom));
  }

  /* Burbujas m√°s anchas y c√≥modas en m√≥vil */
  .msg-in .bubble{
    max-width: 92% !important;
    min-width: 66% !important;
    padding: 12px 16px;
    margin-bottom: 12px;
  }

  /* (notch de IA desactivado) */
  .bubble-ai::before{
    content:none !important;
  }

  /* La esfera-Avatar un pel√≠n m√°s compacta */
  .avatar-sphere{
    width: 1.7rem;
    height: 1.7rem;
    margin-left: 2px;
  }
}

/* Cuando saltas al √∫ltimo mensaje, que no quede oculto tras el input fijo */
.msg-in:last-child{ scroll-margin-bottom: 140px; }

/* ===== Mobile: burbuja al tama√±o del texto (usuario y IA) ===== */
@media (max-width: 640px){
  .msg-in .bubble{
    display: inline-flex !important;
    width: -webkit-fit-content !important;
    width: -moz-fit-content !important;
    width: fit-content !important;     /* << ancho = contenido real */
    min-width: 0 !important;           /* por si alguna util fij√≥ min-w */
    max-width: calc(100vw - 120px) !important; /* wrap si es larga */
    white-space: pre-wrap;
    word-break: break-word;
  }
  /* Alineaci√≥n sin estirar */
  .msg-in.justify-start .bubble{ margin-right: auto; } /* IA a la izquierda */
  .msg-in.justify-end   .bubble{ margin-left:  auto; } /* Usuario a la derecha */
}

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Reply chip (bot√≥n) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.reply-chip{
  font-size: 11px;
  line-height: 1;
  padding: 6px 10px;
  border-radius: 9999px;
  color: #475569;
  background: rgba(255,255,255,.85);
  border: 1px solid rgba(15,23,42,.08);
  box-shadow: 0 4px 10px rgba(15,23,42,.06);
  -webkit-backdrop-filter: blur(6px);
  backdrop-filter: blur(6px);
  transition: transform .15s ease, background-color .15s ease, box-shadow .15s ease;
}
.reply-chip:hover{ background:#f8fafc; transform: translateY(-1px); }
.reply-chip:active{ transform: translateY(0); }

/* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Preview del mensaje a responder ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
.reply-preview{
  position: relative;
  padding: 8px 34px 8px 12px;
  border-radius: 12px;
  border: 1px solid rgba(15,23,42,.06);
  background: linear-gradient(to right, rgba(244,240,255,.7), rgba(255,255,255,.7));
  -webkit-backdrop-filter: blur(6px);
  backdrop-filter: blur(6px);
  box-shadow: 0 10px 24px -12px rgba(2,6,23,.12);
}
.reply-preview::before{
  content:"";
  position:absolute; left:0; top:0; bottom:0; width:3px; border-radius:12px 0 0 12px;
  background-image: linear-gradient(180deg,#E0B89F,#B55FDE,#EA6987,#85B4E2);
  opacity:.85;
}
.reply-preview .rp-title{
  font-size:11px; font-weight:600; color:#64748b; margin-bottom:2px;
}
.reply-preview .rp-text{
  font-size:12px; color:#475569;
  display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;
}
.reply-preview .rp-close{
  position:absolute; right:6px; top:6px;
  width:22px; height:22px; border-radius:9999px;
  display:grid; place-items:center;
  color:#64748b; background:rgba(255,255,255,.65);
  border:1px solid rgba(15,23,42,.06);
}
.reply-preview .rp-close:hover{ background:#ffffff; }

@media (max-width: 640px){
  .reply-chip{ font-size: 10px; padding: 6px 9px; }
  .reply-preview{ padding: 8px 32px 8px 10px; }
}

/* Bot√≥n chip ‚ÄúResponder‚Äù bajo la burbuja de la IA (estilo alterno suave) */
.reply-chip{
  display:inline-flex; align-items:center; gap:6px;
  font-size:11px; line-height:1; color:#64748b;
  padding:6px 10px; border-radius:9999px;
  background:#fff; border:1px solid #e5e7eb;
  box-shadow:0 2px 6px rgba(2,6,23,.06);
  transition:all .15s ease;
}
.reply-chip:hover{ color:#0f172a; border-color:#cbd5e1; box-shadow:0 4px 10px rgba(2,6,23,.08); }

/* Preview ‚ÄúRespondiendo a ‚Ä¶‚Äù encima del input (estilo alterno) */
.reply-preview{
  display:flex; align-items:flex-start; gap:10px;
  background:rgba(255,255,255,.95);
  -webkit-backdrop-filter:blur(8px); backdrop-filter:blur(8px);
  border:1px solid rgba(15,23,42,.08);
  border-radius:14px; padding:8px 12px;
  box-shadow:0 8px 20px -10px rgba(2,6,23,.15);
}
.reply-preview__label{
  font-size:11px; color:#94a3b8; margin-top:2px; white-space:nowrap;
}
.reply-preview__text{
  font-size:12px; color:#475569;
  display:-webkit-box; -webkit-box-orient:vertical; -webkit-line-clamp:2;
  overflow:hidden; text-overflow:ellipsis;
}
.reply-preview__close{
  margin-left:auto; flex:none;
  display:inline-flex; align-items:center; justify-content:center;
  width:22px; height:22px; border-radius:9999px;
  color:#64748b; background:#f8fafc; border:1px solid #e2e8f0;
}
.reply-preview__close:hover{ background:#f1f5f9; color:#0f172a; }

/* ========== Kill-switch por si el markup a√∫n se monta ========== */
.thinking-overlay { display:none !important; }

/* ====== Header: swap con efecto de luces EN el texto ====== */
.header-status-wrap{
  display:inline-block;
  position:relative;
}

.header-status-swap{
  position: relative;
  display: inline-block;
  height: 1.1rem;            /* alto estable para evitar saltos */
  min-width: 200px;          /* evita reflow brusco en el swap */
}

.header-title{
  position: absolute;
  inset: 0;
  display: inline-block;
  text-align: center;
  font-weight: 600;
  font-size: 0.9rem;
  color: #475569;            /* gris normal */
  opacity: 0;
  transform: translateY(6px) scale(.98);
  transition: opacity .26s ease, transform .26s ease, filter .26s ease;
  filter: blur(0);
  will-change: opacity, transform, filter;
}

.header-title.is-active{
  opacity: 1;
  transform: none;
}

/* Variante ‚ÄúPensando‚Ä¶‚Äù con luces dentro del texto */
.header-title.thinking{
  color: transparent;                       /* el relleno ser√° el gradient */
  background: linear-gradient(
    90deg,
    #B55FDE, #5E2EF4, #EA6987, #F6AEBC, #85B4E2, #E0B89F, #B55FDE
  );
  background-size: 220% 100%;
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: header-text-pan 5.8s ease-in-out infinite alternate;
}

/* Halo: duplicamos el mismo texto detr√°s, con blur y el mismo gradient */
.header-title.thinking::after{
  content: attr(data-text);
  position: absolute;
  inset: 0;
  color: transparent;
  -webkit-text-fill-color: transparent;
  background: linear-gradient(
    90deg,
    #B55FDE, #5E2EF4, #EA6987, #F6AEBC, #85B4E2, #E0B89F, #B55FDE
  );
  background-size: 220% 100%;
  -webkit-background-clip: text;
  background-clip: text;

  /* El ‚Äúdegradado alrededor‚Äù: blur + leve escala para que salga fuera de las letras */
  filter: blur(10px) saturate(1.35) brightness(1.06);
  transform: scale(1.06);
  opacity: .70;
  pointer-events: none;

  animation: header-text-pan 5.8s ease-in-out infinite alternate;
  transition: opacity .3s ease;
}

/* Suaviza todav√≠a m√°s la entrada/salida del halo cuando se activa/desactiva */
.header-title.thinking:not(.is-active)::after{
  opacity: 0;
}

/* Movimiento del gradiente dentro del texto */
@keyframes header-text-pan{
  0%   { background-position: 0% 50%; }
  100% { background-position: 100% 50%; }
}

/* Responsive afinado para m√≥vil (texto un pel√≠n m√°s grande y glow m√°s suave) */
@media (max-width: 640px){
  .header-status-swap{ height: 1.2rem; min-width: 180px; }
  .header-title{ font-size: .95rem; }
  .header-title.thinking::after{ filter: blur(9px) saturate(1.25) brightness(1.05); }
}